rm(list=ls())
source("fitnessFunctions.R")
source("centroidSequence.R")
library(unittest, quietly = TRUE)

# test_params
eps = 0.00000001
D = 2
N = 100
max_generations = 1
fitness_func = quadratic

test_population = matrix(c(
      c(-0.34303962, -0.14006847),
      c(-0.22943836,-0.37681416),
      c(-0.12666971,1.72273752),
      c(1.16532149,0.90285711),
      c(-1.1224439 ,0.05341728),
      c(-0.26837284,0.32076975),
      c(-0.64500379,1.35992538),
      c(1.02007229,2.23234931),
      c(-0.31239878,-0.03610183),
      c( 1.27055288,-0.19951494),
      c(1.10929522,1.61443861),
      c(1.1496053 ,2.03025903),
      c(-1.00837464,1.06989833),
      c(-1.11482798,-1.76053901),
      c(0.74976124,0.47700662),
      c( 0.24712949,-1.38777309),
      c(1.99456762,0.07919687),
      c(-2.63599853,1.44211043),
      c(-1.09130137,1.87606951),
      c(0.05983121,0.32046318),
      c(-1.20779933,1.14272966),
      c(0.31201385,1.32176869),
      c( 0.16251474,-1.32726464),
      c( 0.27301613,-0.07460142),
      c(0.39499667,0.2190434 ),
      c(-0.69058676,-0.66967541),
      c(-1.32212335e+00,5.34071554e-06),
      c(1.07217538,1.46864331),
      c(-1.39521096,-0.79357373),
      c(-0.77738137,-1.91395103),
      c(-0.86574373,-1.95677275),
      c(-1.79579397,-0.93618683),
      c(0.43081035,2.16583805),
      c(1.44530459,1.17192137),
      c(-0.89319251,-0.81987624),
      c( 0.01205039,-0.98228016),
      c(0.11522512,0.31550612),
      c(-0.02763353,-0.19768746),
      c( 0.00464662,-1.45616461),
      c(-1.89339341,0.22276381),
      c(1.86931451,1.15461288),
      c( 0.28857485,-1.03201721),
      c( 1.14263316,-1.2507225 ),
      c(1.30562067,0.69621048),
      c( 1.40103725,-0.11300773),
      c(-0.84525407,-2.27660841),
      c(-0.50413945,1.04664469),
      c(-0.88300631,1.02615969),
      c(-0.20170086,-1.64418394),
      c(-0.69352956,-0.77420698),
      c(-0.74316558,1.23777154),
      c(-0.79594864,1.55159739),
      c(-1.09258729,-0.37601563),
      c(-0.48415103,-1.04253218),
      c( 2.04305884,-0.81051195),
      c(2.27578463,1.36484032),
      c(-1.21373163,-0.15893595),
      c( 0.15553162,-2.74978412),
      c(0.52726681,0.40633855),
      c( 1.46438939,-0.20332035),
      c(2.00379721,0.55220113),
      c(-0.28580329,0.6034105 ),
      c(0.47331189,0.21652363),
      c(1.13344872,0.14180279),
      c(-0.42689543,0.2788902 ),
      c(-0.70572542,-0.17225903),
      c(-0.5482615 ,0.47092229),
      c( 0.2464502 ,-1.33109879),
      c(0.30688067,1.36046206),
      c(-1.97789885,-1.49390571),
      c(-1.7122581 ,-0.76221409),
      c(-0.47019344,1.14115572),
      c(-1.37362775,-1.36714046),
      c( 1.36865394,-2.91539562),
      c( 0.49766986,-1.77313913),
      c(1.86787878,1.4695464 ),
      c(0.3650815 ,0.96836702),
      c(-1.99456772,0.81810192),
      c(0.26485777,2.01304821),
      c( 0.39721759,-1.72497832),
      c( 0.95040644,-0.16756571),
      c(-0.69995473,-0.15400078),
      c(1.82288246,0.11976941),
      c(-0.82148088,-1.59395945),
      c(0.1696733 ,0.49631761),
      c(0.60108974,1.66543799),
      c(-0.47208856,-0.91387316),
      c(0.48415256,0.55939045),
      c( 0.71389204,-0.85155658),
      c(-0.27753626,0.37930812),
      c(-1.54784995,-0.40500412),
      c(0.39261525,0.7606199 ),
      c(-0.53231261,0.84516125),
      c(-1.99282355,0.16143246),
      c(-0.35587276,-1.47559164),
      c(-0.29982881,0.62938996),
      c( 0.56424029,-1.1336259 ),
      c(0.20764485,0.46658267),
      c(-0.33450687,-2.14302168),
      c(0.04200341,0.63260354)
    ), ncol=D, nrow=N, byrow=TRUE)

# testBestPoint_quadratic <- function (population) {
#    ok(getBestPoint(population) == c(-0.02763353, -0.19768746))
# }
# 
# testBestPoint_quadratic(test_population)

testCentralPoint <- function(population) {
   proper_solution = c(-0.03717479,  0.00925317)
   test_solution = getCentralPoint(population)
   
   ok(sum(abs(proper_solution - test_solution)) < eps)
}
testCentralPoint(test_population)


testSequence <- function(population) {
   proper_solution = matrix(c(
      c(-0.03717479,  0.00925317),
      c(-0.05137508,  0.03879507),
      c(-0.02500137,  0.02447553),
      c(-0.02686253,  0.05307614),
      c(-0.05084844,  0.03941193),
      c(-0.03056370,  0.05555212),
      c(-0.04174068,  0.0323947 ),
      c(-0.03310075,  0.05722269),
      c(-0.05376357,  0.04187135),
      c(-0.06698740,  0.02002093),
      c(-0.07251849, -0.00382148),
      c(-0.09628902,  0.00524246),
      c(-0.11862542, -0.00781857),
      c(-0.10744524, -0.02947245),
      c(-0.10480499, -0.0048963 ),
      c(-0.08257249, -0.01457863),
      c(-0.07324902,  0.00854273),
      c(-0.06069988,  0.02985696),
      c(-0.08587667,  0.02348691),
      c(-0.07733957,  0.0474059 ),
      c(-0.08161704,  0.02283537),
      c(-0.05991860,  0.03497489),
      c(-0.03513777,  0.03335364),
      c(-0.06149758,  0.03275827),
      c(-0.07690275,  0.01194669),
      c(-0.05961308,  0.03033452),
      c(-0.03483226,  0.02773412),
      c(-0.01185383,  0.03855533),
      c(-0.03209214,  0.02281414),
      c(-0.03955357,  0.04810925),
      c(-0.06615980,  0.04708554),
      c(-0.08265742,  0.02648325),
      c(-0.07179236,  0.05031329),
      c(-0.08183538,  0.02620695),
      c(-0.08909376,  0.05274006),
      c(-0.07821907,  0.02968072),
      c(-0.07746203,  0.00322671),
      c(-0.09682862,  0.02313066),
      c(-0.07890974,  0.00507261),
      c(-0.07689677,  0.03210961),
      c(-0.05492486,  0.04587099),
      c(-0.02962105,  0.05351295),
      c(-0.02399602,  0.07987682),
      c(-0.01310115,  0.05741983),
      c(-0.03664975,  0.04601285),
      c(-0.06394137,  0.05054618),
      c(-0.08670550,  0.03476265),
      c(-0.06931551,  0.01523178),
      c(-0.07073786,  0.04352787),
      c(-0.05755300,  0.02011132),
      c(-0.06364665,  0.04826901),
      c(-0.09353816,  0.05156038),
      c(-0.10188022,  0.02429159),
      c(-0.11068648, -0.00331431),
      c(-0.09389692, -0.02569417),
      c(-0.10146019,  0.00331482),
      c(-0.10745962,  0.03355526),
      c(-0.07921162,  0.03433549),
      c(-0.11134887,  0.03990336),
      c(-0.12782666,  0.06852602),
      c(-0.11926749,  0.04171028),
      c(-0.09120430,  0.04685505),
      c(-0.07009935,  0.06966377),
      c(-0.05836854,  0.04325888),
      c(-0.02964024,  0.0549054 ),
      c(-0.01665422,  0.08626076),
      c(-0.05048077,  0.08462717),
      c(-0.01799704,  0.08557292),
      c(-0.04086858,  0.11485822),
      c(-0.05149578,  0.1518542 ),
      c(-0.03009466,  0.18272291),
      c(-0.04372142,  0.15563173),
      c(-0.02842260,  0.19382833),
      c(-0.00976000,  0.16970489),
      c(-0.01059886,  0.21401201),
      c(-0.04903908,  0.22927512),
      c(-0.02230792,  0.26673139),
      c(-0.05587615,  0.25758899),
      c(-0.07626212,  0.23472395),
      c(-0.10294853,  0.21926364),
      c(-0.07280969,  0.23883977),
      c(-0.04778591,  0.2266249 ),
      c(-0.01155431,  0.24777077),
      c( 0.00540302,  0.22532258),
      c( 0.02360341,  0.20169209),
      c(-0.00997415,  0.18804899),
      c(-0.01368683,  0.1562951 ),
      c(-0.02779146,  0.13013952),
      c(-0.06955007,  0.12294084),
      c(-0.09474961,  0.09170068),
      c(-0.06153503,  0.07298172),
      c(-0.03753489,  0.03894546),
      c(-0.09160133,  0.01643321),
      c(-0.07191033,  0.07261141),
      c(-0.03916658,  0.03125169),
      c( 0.02160803,  0.06551572),
      c(-0.00179624,  0.00301812),
      c(-0.02233873, -0.1027969 ),
      c( 0.12269130, -0.13614444),
      c(-0.02763353, -0.19768746)
   ), ncol=D, nrow=N, byrow=TRUE)
   test_solution = getSequence(as_tibble(population), quadratic)
   ok(sum(abs(proper_solution - test_solution)) < eps * D * N)
}
testSequence(test_population)

testEstimator_quadratic <- function(population) {
   proper_solution = c(-0.03660783,  0.11650104)
   test_solution = getEstimatorPoint(population, quadratic)
   ok(sum(abs(proper_solution - test_solution)) < eps)
}
testEstimator_quadratic(test_population)

